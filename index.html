<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Time Freezes, You Move - 30 Levels</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
<style>
body { 
    margin:0; 
    background:#111; 
    color:#fff; 
    font-family:sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
}
#game-container {
    position: relative;
}
#touch-controls { 
    margin-top: 20px;
    text-align: center;
}
.btn { 
    width:90px; 
    height:90px; 
    font-size:36px; 
    margin:8px; 
    background:#333; 
    color:#fff; 
    border:3px solid #666; 
    border-radius:12px;
    cursor: pointer;
    user-select: none;
    touch-action: manipulation;
}
.btn:active { 
    background:#555; 
    transform: scale(0.95);
}
</style>
</head>
<body>

<div id="game-container"></div>

<div id="touch-controls">
  <button class="btn" id="up">‚¨ÜÔ∏è</button><br>
  <button class="btn" id="left">‚¨ÖÔ∏è</button>
  <button class="btn" id="down">‚¨áÔ∏è</button>
  <button class="btn" id="right">‚û°Ô∏è</button>
</div>

<script>
// Global movement keys
let moveKeys = {up:false, down:false, left:false, right:false};

// --- Menu Scene ---
class MenuScene extends Phaser.Scene {
    constructor() { 
        super({key:'MenuScene'}); 
    }
    
    create() {
        const scene = this;

        scene.add.text(400, 50, 'TIME FREEZES', {fontSize:'56px', color:'#0ff', fontStyle:'bold'}).setOrigin(0.5);
        scene.add.text(400, 110, 'YOU MOVE', {fontSize:'42px', color:'#0f0', fontStyle:'bold'}).setOrigin(0.5);
        scene.add.text(400, 160, 'Move to unfreeze time ‚Ä¢ Stop to freeze bullets', {fontSize:'20px', color:'#aaa'}).setOrigin(0.5);
        scene.add.text(400, 190, '‚ö†Ô∏è EXTREME DIFFICULTY after Level 10!', {fontSize:'18px', color:'#f00'}).setOrigin(0.5);

        let playBtn = scene.add.text(400, 230, '‚ñ∂ START GAME', {
            fontSize:'32px',
            color:'#0ff',
            backgroundColor:'#000',
            padding:{x:24, y:12}
        }).setOrigin(0.5).setInteractive();
        
        playBtn.on('pointerdown', () => scene.createLevelSelect());
        playBtn.on('pointerover', () => playBtn.setColor('#ff0'));
        playBtn.on('pointerout', () => playBtn.setColor('#0ff'));

        scene.unlockedLevel = parseInt(localStorage.getItem('unlockedLevel') || '1');
    }

    createLevelSelect() {
        const scene = this;
        scene.children.removeAll();
        
        scene.add.text(400, 30, 'SELECT LEVEL', {fontSize:'36px', color:'#0ff', fontStyle:'bold'}).setOrigin(0.5);
        scene.add.text(400, 75, 'Levels 1-10: Normal ‚Ä¢ 11-30: EXTREME', {fontSize:'18px', color:'#aaa'}).setOrigin(0.5);
        
        let x0 = 120, y0 = 110, cols = 10, spacing = 65;
        
        for(let i = 1; i <= 30; i++) {
            let x = x0 + ((i-1) % cols) * spacing;
            let y = y0 + Math.floor((i-1) / cols) * spacing;
            let unlocked = i <= scene.unlockedLevel;
            
            let color = '#444';
            if(unlocked) {
                color = i <= 10 ? '#0f0' : '#f00'; // Green for easy, red for hard
            }
            
            let txt = scene.add.text(x, y, i, {
                fontSize:'24px',
                color: color,
                backgroundColor:'#222',
                padding:{x:16, y:12}
            }).setOrigin(0.5).setInteractive();
            
            if(unlocked) {
                txt.on('pointerdown', () => {
                    scene.scene.start('GameScene', {level: i});
                });
                txt.on('pointerover', () => txt.setColor('#0ff'));
                txt.on('pointerout', () => txt.setColor(color));
            }
        }
    }
}

// --- Game Scene ---
class GameScene extends Phaser.Scene {
    constructor() { 
        super({key:'GameScene'}); 
    }
    
    init(data) { 
        this.levelNumber = data.level || 1; 
    }
    
    create() {
        const scene = this;
        this.cursors = this.input.keyboard.createCursorKeys();
        this.timeFrozen = true;
        
        this.loadLevel(this.levelNumber);
    }

    loadLevel(levelNum) {
        // Define all 30 levels - EXTREME DIFFICULTY after level 10
        this.levels = [
            // Levels 1-10: Normal difficulty warm-up
            {player:{x:100,y:250}, goal:{x:700,y:250}, bullets:[{x:400,y:100,vy:120}], walls:[]},
            {player:{x:50,y:400}, goal:{x:750,y:100}, bullets:[{x:300,y:150,vy:120},{x:600,y:250,vy:120}], walls:[]},
            {player:{x:100,y:100}, goal:{x:700,y:400}, bullets:[{x:400,y:200,vy:150},{x:500,y:300,vy:150},{x:300,y:100,vy:150}], walls:[]},
            {player:{x:50,y:250}, goal:{x:750,y:250}, bullets:[{x:200,y:50,vy:100},{x:400,y:100,vy:100},{x:600,y:150,vy:100}], walls:[]},
            {player:{x:100,y:450}, goal:{x:700,y:50}, bullets:[{x:250,y:0,vy:130},{x:400,y:50,vy:130},{x:550,y:100,vy:130}], walls:[]},
            {player:{x:50,y:250}, goal:{x:750,y:250}, bullets:[{x:300,y:100,vy:120},{x:500,y:50,vy:120}], walls:[{x:400,y:100,w:20,h:300}]},
            {player:{x:100,y:100}, goal:{x:700,y:400}, bullets:[{x:350,y:100,vy:140},{x:450,y:100,vy:140}], walls:[{x:300,y:150,w:200,h:20}]},
            {player:{x:50,y:250}, goal:{x:750,y:250}, bullets:[{x:200,y:0,vy:120},{x:600,y:100,vy:120}], walls:[{x:250,y:150,w:20,h:200},{x:550,y:150,w:20,h:200}]},
            {player:{x:100,y:50}, goal:{x:700,y:450}, bullets:[{x:350,y:200,vy:130},{x:500,y:200,vy:130}], walls:[{x:250,y:250,w:300,h:20}]},
            {player:{x:50,y:400}, goal:{x:750,y:100}, bullets:[{x:300,y:0,vy:150},{x:400,y:0,vy:150},{x:500,y:100,vy:150}], walls:[{x:200,y:250,w:400,h:20}]},
            
            // Levels 11-15: EXTREME - Bullet hell begins
            {player:{x:100,y:250}, goal:{x:700,y:250}, 
             bullets:[{x:200,y:0,vy:200},{x:250,y:80,vy:200},{x:300,y:160,vy:200},{x:350,y:40,vy:200},{x:400,y:120,vy:200},{x:450,y:200,vy:200},{x:500,y:100,vy:200},{x:550,y:180,vy:200},{x:600,y:60,vy:200}], 
             walls:[{x:350,y:100,w:20,h:80},{x:350,y:320,w:20,h:80},{x:450,y:180,w:20,h:80},{x:450,y:340,w:20,h:80}]},
            
            {player:{x:50,y:450}, goal:{x:750,y:50}, 
             bullets:[{x:150,y:0,vy:220},{x:200,y:100,vy:220},{x:250,y:50,vy:220},{x:300,y:150,vy:220},{x:400,y:0,vy:220},{x:450,y:100,vy:220},{x:500,y:50,vy:220},{x:550,y:150,vy:220},{x:600,y:100,vy:220},{x:650,y:0,vy:220}], 
             walls:[{x:200,y:200,w:150,h:20},{x:450,y:300,w:150,h:20}]},
            
            {player:{x:100,y:100}, goal:{x:700,y:400}, 
             bullets:[{x:180,y:50,vy:210},{x:220,y:100,vy:210},{x:260,y:0,vy:210},{x:300,y:150,vy:210},{x:380,y:80,vy:210},{x:420,y:120,vy:210},{x:460,y:40,vy:210},{x:520,y:100,vy:210},{x:560,y:0,vy:210},{x:600,y:150,vy:210},{x:640,y:80,vy:210}], 
             walls:[{x:250,y:200,w:100,h:20},{x:450,y:280,w:100,h:20},{x:350,y:350,w:100,h:20}]},
            
            {player:{x:50,y:250}, goal:{x:750,y:250}, 
             bullets:[{x:150,y:100,vy:230},{x:180,y:0,vy:230},{x:220,y:150,vy:230},{x:280,y:50,vy:230},{x:320,y:120,vy:230},{x:380,y:80,vy:230},{x:420,y:0,vy:230},{x:480,y:150,vy:230},{x:520,y:100,vy:230},{x:580,y:50,vy:230},{x:620,y:130,vy:230},{x:660,y:80,vy:230}], 
             walls:[{x:200,y:120,w:20,h:80},{x:300,y:300,w:20,h:80},{x:400,y:180,w:20,h:100},{x:500,y:250,w:20,h:80},{x:600,y:150,w:20,h:90}]},
            
            {player:{x:100,y:400}, goal:{x:700,y:100}, 
             bullets:[{x:170,y:80,vy:240},{x:200,y:150,vy:240},{x:240,y:0,vy:240},{x:280,y:100,vy:240},{x:330,y:50,vy:240},{x:370,y:140,vy:240},{x:420,y:90,vy:240},{x:460,y:0,vy:240},{x:510,y:120,vy:240},{x:550,y:60,vy:240},{x:590,y:150,vy:240},{x:640,y:30,vy:240}], 
             walls:[{x:250,y:200,w:80,h:20},{x:400,y:280,w:80,h:20},{x:550,y:220,w:80,h:20},{x:350,y:350,w:100,h:20}]},
            
            // Levels 16-20: EXTREME - Maze + Speed
            {player:{x:50,y:450}, goal:{x:750,y:50}, 
             bullets:[{x:150,y:0,vy:250},{x:180,y:100,vy:250},{x:220,y:50,vy:250},{x:260,y:130,vy:250},{x:310,y:70,vy:250},{x:350,y:150,vy:250},{x:400,y:30,vy:250},{x:450,y:110,vy:250},{x:500,y:80,vy:250},{x:550,y:140,vy:250},{x:600,y:20,vy:250},{x:650,y:100,vy:250}], 
             walls:[{x:180,y:150,w:20,h:100},{x:180,y:330,w:20,h:100},{x:280,y:200,w:80,h:20},{x:380,y:100,w:20,h:120},{x:380,y:300,w:20,h:120},{x:480,y:180,w:100,h:20},{x:580,y:250,w:20,h:150}]},
            
            {player:{x:100,y:100}, goal:{x:700,y:400}, 
             bullets:[{x:160,y:80,vy:260},{x:190,y:0,vy:260},{x:220,y:120,vy:260},{x:260,y:60,vy:260},{x:300,y:140,vy:260},{x:340,y:20,vy:260},{x:390,y:100,vy:260},{x:430,y:150,vy:260},{x:480,y:40,vy:260},{x:520,y:110,vy:260},{x:560,y:80,vy:260},{x:610,y:0,vy:260},{x:650,y:130,vy:260}], 
             walls:[{x:200,y:150,w:20,h:80},{x:300,y:220,w:100,h:20},{x:450,y:150,w:20,h:100},{x:550,y:280,w:120,h:20},{x:380,y:350,w:20,h:100}]},
            
            {player:{x:50,y:250}, goal:{x:750,y:250}, 
             bullets:[{x:140,y:100,vy:270},{x:170,y:0,vy:270},{x:200,y:150,vy:270},{x:240,y:50,vy:270},{x:280,y:130,vy:270},{x:320,y:80,vy:270},{x:360,y:0,vy:270},{x:410,y:120,vy:270},{x:450,y:60,vy:270},{x:490,y:140,vy:270},{x:540,y:90,vy:270},{x:580,y:20,vy:270},{x:620,y:110,vy:270},{x:660,y:150,vy:270}], 
             walls:[{x:160,y:120,w:20,h:70},{x:250,y:280,w:80,h:20},{x:350,y:150,w:20,h:80},{x:450,y:300,w:20,h:100},{x:550,y:180,w:20,h:90},{x:600,y:320,w:80,h:20}]},
            
            {player:{x:100,y:450}, goal:{x:700,y:50}, 
             bullets:[{x:150,y:50,vy:280},{x:180,y:120,vy:280},{x:210,y:0,vy:280},{x:250,y:80,vy:280},{x:290,y:140,vy:280},{x:330,y:30,vy:280},{x:380,y:100,vy:280},{x:420,y:150,vy:280},{x:460,y:60,vy:280},{x:500,y:0,vy:280},{x:550,y:120,vy:280},{x:590,y:70,vy:280},{x:630,y:140,vy:280},{x:670,y:90,vy:280}], 
             walls:[{x:200,y:180,w:100,h:20},{x:350,y:280,w:20,h:100},{x:450,y:200,w:80,h:20},{x:550,y:320,w:100,h:20},{x:480,y:350,w:20,h:100}]},
            
            {player:{x:50,y:100}, goal:{x:750,y:400}, 
             bullets:[{x:140,y:0,vy:290},{x:170,y:80,vy:290},{x:200,y:140,vy:290},{x:240,y:30,vy:290},{x:280,y:100,vy:290},{x:320,y:150,vy:290},{x:360,y:50,vy:290},{x:410,y:120,vy:290},{x:450,y:0,vy:290},{x:490,y:90,vy:290},{x:540,y:140,vy:290},{x:580,y:60,vy:290},{x:620,y:110,vy:290},{x:660,y:20,vy:290}], 
             walls:[{x:180,y:180,w:20,h:100},{x:280,y:250,w:100,h:20},{x:400,y:150,w:20,h:100},{x:500,y:300,w:80,h:20},{x:600,y:200,w:20,h:120}]},
            
            // Levels 21-25: INSANE - Maximum chaos
            {player:{x:100,y:250}, goal:{x:700,y:250}, 
             bullets:[{x:130,y:100,vy:300},{x:155,y:0,vy:300},{x:180,y:120,vy:300},{x:205,y:60,vy:300},{x:230,y:140,vy:300},{x:255,y:30,vy:300},{x:285,y:90,vy:300},{x:310,y:150,vy:300},{x:340,y:50,vy:300},{x:370,y:110,vy:300},{x:400,y:0,vy:300},{x:430,y:130,vy:300},{x:460,y:70,vy:300},{x:490,y:140,vy:300},{x:520,y:40,vy:300},{x:550,y:100,vy:300},{x:580,y:150,vy:300},{x:610,y:80,vy:300},{x:640,y:20,vy:300},{x:670,y:120,vy:300}], 
             walls:[{x:150,y:120,w:20,h:60},{x:220,y:280,w:60,h:20},{x:300,y:150,w:20,h:70},{x:380,y:320,w:80,h:20},{x:460,y:180,w:20,h:80},{x:540,y:260,w:70,h:20},{x:620,y:140,w:20,h:80}]},
            
            {player:{x:50,y:50}, goal:{x:750,y:450}, 
             bullets:[{x:120,y:80,vy:310},{x:145,y:140,vy:310},{x:170,y:20,vy:310},{x:195,y:100,vy:310},{x:225,y:50,vy:310},{x:250,y:130,vy:310},{x:280,y:70,vy:310},{x:310,y:0,vy:310},{x:340,y:110,vy:310},{x:370,y:150,vy:310},{x:405,y:60,vy:310},{x:435,y:120,vy:310},{x:465,y:30,vy:310},{x:495,y:90,vy:310},{x:530,y:140,vy:310},{x:560,y:50,vy:310},{x:590,y:100,vy:310},{x:620,y:0,vy:310},{x:650,y:120,vy:310},{x:680,y:80,vy:310}], 
             walls:[{x:160,y:200,w:80,h:20},{x:280,y:280,w:20,h:100},{x:380,y:200,w:80,h:20},{x:480,y:320,w:100,h:20},{x:550,y:240,w:20,h:80}]},
            
            {player:{x:100,y:400}, goal:{x:700,y:100}, 
             bullets:[{x:130,y:50,vy:320},{x:155,y:110,vy:320},{x:180,y:0,vy:320},{x:210,y:140,vy:320},{x:235,y:80,vy:320},{x:265,y:120,vy:320},{x:290,y:40,vy:320},{x:320,y:100,vy:320},{x:350,y:150,vy:320},{x:380,y:60,vy:320},{x:415,y:20,vy:320},{x:445,y:130,vy:320},{x:475,y:70,vy:320},{x:505,y:110,vy:320},{x:540,y:0,vy:320},{x:570,y:140,vy:320},{x:600,y:90,vy:320},{x:630,y:50,vy:320},{x:660,y:120,vy:320}], 
             walls:[{x:180,y:180,w:20,h:80},{x:260,y:260,w:80,h:20},{x:360,y:180,w:20,h:90},{x:440,y:300,w:100,h:20},{x:540,y:200,w:20,h:80},{x:620,y:280,w:80,h:20}]},
            
            {player:{x:50,y:250}, goal:{x:750,y:250}, 
             bullets:[{x:120,y:100,vy:330},{x:140,y:0,vy:330},{x:165,y:130,vy:330},{x:190,y:60,vy:330},{x:215,y:140,vy:330},{x:240,y:30,vy:330},{x:270,y:100,vy:330},{x:295,y:150,vy:330},{x:325,y:50,vy:330},{x:350,y:110,vy:330},{x:380,y:0,vy:330},{x:410,y:140,vy:330},{x:440,y:70,vy:330},{x:470,y:120,vy:330},{x:500,y:40,vy:330},{x:530,y:90,vy:330},{x:560,y:150,vy:330},{x:590,y:80,vy:330},{x:620,y:20,vy:330},{x:650,y:110,vy:330},{x:680,y:140,vy:330}], 
             walls:[{x:140,y:110,w:20,h:70},{x:210,y:280,w:70,h:20},{x:290,y:150,w:20,h:80},{x:370,y:320,w:80,h:20},{x:450,y:170,w:20,h:90},{x:530,y:260,w:80,h:20},{x:610,y:130,w:20,h:80},{x:660,y:300,w:70,h:20}]},
            
            {player:{x:100,y:100}, goal:{x:700,y:400}, 
             bullets:[{x:125,y:80,vy:340},{x:150,y:140,vy:340},{x:175,y:20,vy:340},{x:205,y:100,vy:340},{x:230,y:50,vy:340},{x:260,y:130,vy:340},{x:285,y:70,vy:340},{x:315,y:0,vy:340},{x:340,y:110,vy:340},{x:370,y:150,vy:340},{x:400,y:60,vy:340},{x:430,y:120,vy:340},{x:460,y:30,vy:340},{x:490,y:90,vy:340},{x:525,y:140,vy:340},{x:555,y:50,vy:340},{x:585,y:100,vy:340},{x:615,y:0,vy:340},{x:645,y:120,vy:340},{x:675,y:80,vy:340}], 
             walls:[{x:170,y:180,w:20,h:80},{x:250,y:260,w:80,h:20},{x:350,y:180,w:20,h:90},{x:430,y:310,w:90,h:20},{x:530,y:200,w:20,h:80},{x:610,y:290,w:80,h:20}]},
            
            // Levels 26-30: IMPOSSIBLE - Pure skill test
            {player:{x:50,y:450}, goal:{x:750,y:50}, 
             bullets:[{x:110,y:90,vy:350},{x:130,y:0,vy:350},{x:150,y:120,vy:350},{x:175,y:60,vy:350},{x:195,y:140,vy:350},{x:220,y:30,vy:350},{x:245,y:100,vy:350},{x:270,y:150,vy:350},{x:295,y:50,vy:350},{x:320,y:110,vy:350},{x:345,y:0,vy:350},{x:375,y:130,vy:350},{x:400,y:70,vy:350},{x:425,y:140,vy:350},{x:450,y:40,vy:350},{x:480,y:100,vy:350},{x:505,y:150,vy:350},{x:535,y:80,vy:350},{x:560,y:20,vy:350},{x:585,y:120,vy:350},{x:615,y:60,vy:350},{x:640,y:140,vy:350},{x:665,y:90,vy:350},{x:690,y:0,vy:350}], 
             walls:[{x:140,y:180,w:20,h:70},{x:210,y:280,w:60,h:20},{x:290,y:160,w:20,h:80},{x:360,y:310,w:80,h:20},{x:440,y:180,w:20,h:80},{x:510,y:260,w:70,h:20},{x:590,y:150,w:20,h:80},{x:650,y:300,w:60,h:20}]},
            
            {player:{x:100,y:100}, goal:{x:700,y:400}, 
             bullets:[{x:115,y:70,vy:360},{x:135,y:130,vy:360},{x:160,y:10,vy:360},{x:185,y:90,vy:360},{x:210,y:140,vy:360},{x:235,y:50,vy:360},{x:265,y:110,vy:360},{x:290,y:0,vy:360},{x:315,y:120,vy:360},{x:345,y:70,vy:360},{x:370,y:150,vy:360},{x:395,y:40,vy:360},{x:425,y:100,vy:360},{x:450,y:130,vy:360},{x:475,y:60,vy:360},{x:505,y:20,vy:360},{x:530,y:140,vy:360},{x:560,y:80,vy:360},{x:585,y:110,vy:360},{x:615,y:0,vy:360},{x:640,y:130,vy:360},{x:665,y:70,vy:360},{x:690,y:100,vy:360}], 
             walls:[{x:160,y:170,w:20,h:70},{x:230,y:270,w:70,h:20},{x:310,y:170,w:20,h:80},{x:380,y:300,w:80,h:20},{x:460,y:180,w:20,h:80},{x:530,y:260,w:70,h:20},{x:600,y:170,w:20,h:80}]},
            
            {player:{x:50,y:250}, goal:{x:750,y:250}, 
             bullets:[{x:105,y:100,vy:370},{x:125,y:0,vy:370},{x:145,y:130,vy:370},{x:170,y:60,vy:370},{x:190,y:140,vy:370},{x:215,y:30,vy:370},{x:240,y:100,vy:370},{x:265,y:150,vy:370},{x:290,y:50,vy:370},{x:315,y:110,vy:370},{x:345,y:0,vy:370},{x:370,y:140,vy:370},{x:395,y:70,vy:370},{x:425,y:120,vy:370},{x:450,y:40,vy:370},{x:475,y:90,vy:370},{x:505,y:150,vy:370},{x:530,y:80,vy:370},{x:555,y:20,vy:370},{x:585,y:110,vy:370},{x:610,y:140,vy:370},{x:635,y:60,vy:370},{x:665,y:100,vy:370},{x:690,y:130,vy:370}], 
             walls:[{x:130,y:110,w:20,h:60},{x:200,y:280,w:60,h:20},{x:270,y:150,w:20,h:70},{x:350,y:310,w:70,h:20},{x:430,y:170,w:20,h:80},{x:500,y:260,w:70,h:20},{x:580,y:140,w:20,h:70},{x:640,y:300,w:60,h:20}]},
            
            {player:{x:100,y:400}, goal:{x:700,y:100}, 
             bullets:[{x:110,y:80,vy:380},{x:130,y:140,vy:380},{x:155,y:20,vy:380},{x:180,y:100,vy:380},{x:205,y:50,vy:380},{x:235,y:130,vy:380},{x:260,y:70,vy:380},{x:285,y:0,vy:380},{x:315,y:110,vy:380},{x:340,y:150,vy:380},{x:365,y:60,vy:380},{x:395,y:120,vy:380},{x:420,y:30,vy:380},{x:445,y:90,vy:380},{x:475,y:140,vy:380},{x:500,y:50,vy:380},{x:530,y:100,vy:380},{x:555,y:0,vy:380},{x:580,y:130,vy:380},{x:610,y:70,vy:380},{x:635,y:120,vy:380},{x:665,y:40,vy:380},{x:690,y:110,vy:380}], 
             walls:[{x:150,y:180,w:20,h:70},{x:220,y:270,w:70,h:20},{x:300,y:170,w:20,h:80},{x:370,y:300,w:80,h:20},{x:450,y:180,w:20,h:80},{x:520,y:270,w:70,h:20},{x:600,y:170,w:20,h:80}]},
            
            {player:{x:50,y:50}, goal:{x:750,y:450}, 
             bullets:[{x:100,y:90,vy:400},{x:120,y:0,vy:400},{x:140,y:120,vy:400},{x:165,y:60,vy:400},{x:185,y:140,vy:400},{x:210,y:30,vy:400},{x:235,y:100,vy:400},{x:260,y:150,vy:400},{x:285,y:50,vy:400},{x:310,y:110,vy:400},{x:340,y:0,vy:400},{x:365,y:140,vy:400},{x:390,y:70,vy:400},{x:420,y:120,vy:400},{x:445,y:40,vy:400},{x:470,y:90,vy:400},{x:500,y:150,vy:400},{x:525,y:80,vy:400},{x:550,y:20,vy:400},{x:580,y:110,vy:400},{x:605,y:140,vy:400},{x:630,y:60,vy:400},{x:660,y:100,vy:400},{x:685,y:130,vy:400},{x:710,y:50,vy:400}], 
             walls:[{x:120,y:160,w:20,h:60},{x:190,y:270,w:60,h:20},{x:260,y:150,w:20,h:70},{x:340,y:300,w:70,h:20},{x:420,y:170,w:20,h:80},{x:490,y:260,w:70,h:20},{x:570,y:150,w:20,h:70},{x:630,y:300,w:60,h:20},{x:680,y:200,w:20,h:60}]}
        ];

        const level = this.levels[levelNum - 1];
        if(!level) { 
            alert("üéâ All levels completed!"); 
            this.scene.start('MenuScene'); 
            return; 
        }

        // Clear previous objects
        if(this.player) this.player.destroy();
        if(this.goal) this.goal.destroy();
        if(this.bullets) this.bullets.clear(true, true);
        if(this.walls) this.walls.clear(true, true);
        if(this.levelText) this.levelText.destroy();
        if(this.menuBtn) this.menuBtn.destroy();
        if(this.difficultyText) this.difficultyText.destroy();

        // UI
        this.levelText = this.add.text(10, 10, `Level ${levelNum}`, {fontSize:'28px', color:'#0ff'});
        
        if(levelNum > 10) {
            this.difficultyText = this.add.text(10, 45, '‚ö†Ô∏è EXTREME', {fontSize:'22px', color:'#f00'});
        }
        
        this.menuBtn = this.add.text(750, 10, 'Menu', {
            fontSize:'24px',
            color:'#aaa',
            backgroundColor:'#222',
            padding:{x:14, y:8}
        }).setOrigin(1, 0).setInteractive();
        this.menuBtn.on('pointerdown', () => this.scene.start('MenuScene'));

        // Initialize groups
        this.bullets = this.physics.add.group();
        this.walls = this.physics.add.staticGroup();

        // Player
        this.player = this.add.text(level.player.x, level.player.y, 'üòé', {fontSize:'48px'});
        this.physics.add.existing(this.player);
        this.player.body.setCollideWorldBounds(true);
        this.player.body.setSize(40, 40);

        // Goal
        this.goal = this.add.rectangle(level.goal.x, level.goal.y, 40, 40, 0x00ff66);
        this.physics.add.existing(this.goal, true);

        // Bullets
        level.bullets.forEach(b => {
            let bullet = this.add.rectangle(b.x, b.y, 16, 16, 0xff3333);
            this.physics.add.existing(bullet);
            bullet.body.setVelocityY(b.vy);
            bullet.originalVY = b.vy;
            this.bullets.add(bullet);
        });

        // Walls
        level.walls.forEach(w => {
            let centerX = w.x + w.w / 2;
            let centerY = w.y + w.h / 2;
            let wall = this.add.rectangle(centerX, centerY, w.w, w.h, 0x666666);
            wall.setOrigin(0.5, 0.5);
            this.physics.add.existing(wall, true);
            this.walls.add(wall);
        });

        // Collisions
        this.physics.add.overlap(this.player, this.bullets, this.lose, null, this);
        this.physics.add.overlap(this.player, this.goal, this.win, null, this);
        this.physics.add.collider(this.player, this.walls);
    }

    update() {
        let moving = false;
        this.player.body.setVelocity(0);

        // Keyboard controls
        if(this.cursors.left.isDown) { 
            this.player.body.setVelocityX(-200); 
            moving = true; 
        } else if(this.cursors.right.isDown) { 
            this.player.body.setVelocityX(200); 
            moving = true; 
        }
        
        if(this.cursors.up.isDown) { 
            this.player.body.setVelocityY(-200); 
            moving = true; 
        } else if(this.cursors.down.isDown) { 
            this.player.body.setVelocityY(200); 
            moving = true; 
        }

        // Touch controls
        if(moveKeys.left) { 
            this.player.body.setVelocityX(-200); 
            moving = true; 
        }
        if(moveKeys.right) { 
            this.player.body.setVelocityX(200); 
            moving = true; 
        }
        if(moveKeys.up) { 
            this.player.body.setVelocityY(-200); 
            moving = true; 
        }
        if(moveKeys.down) { 
            this.player.body.setVelocityY(200); 
            moving = true; 
        }

        this.timeFrozen = !moving;

        // Update bullets
        this.bullets.children.iterate(b => {
            if(this.timeFrozen) { 
                b.body.setVelocity(0); 
                b.fillColor = 0x555555; 
            } else { 
                b.body.setVelocityY(b.originalVY); 
                b.fillColor = 0xff3333; 
            }
            if(b.y > 520) b.y = -20;
        });

        // Player visual feedback
        this.player.text = this.timeFrozen ? 'üòé' : 'üèÉ';
    }

    lose() { 
        this.physics.pause();
        setTimeout(() => {
            this.loadLevel(this.levelNumber);
            this.physics.resume();
        }, 500);
    }
    
    win() { 
        this.physics.pause();
        setTimeout(() => {
            this.levelNumber++; 
            
            // Save progress
            let currentUnlocked = parseInt(localStorage.getItem('unlockedLevel') || '1');
            if(this.levelNumber > currentUnlocked) {
                localStorage.setItem('unlockedLevel', this.levelNumber);
            }
            
            if(this.levelNumber > this.levels.length) { 
                alert("üéâ CONGRATULATIONS! You're a LEGEND! All 30 levels completed!"); 
                this.scene.start('MenuScene'); 
            } else {
                this.loadLevel(this.levelNumber);
                this.physics.resume();
            }
        }, 300);
    }
}

// Setup touch controls after DOM is loaded
window.addEventListener('DOMContentLoaded', () => {
    ['up', 'down', 'left', 'right'].forEach(dir => {
        let btn = document.getElementById(dir);
        
        btn.addEventListener("touchstart", (e) => {
            e.preventDefault(); 
            moveKeys[dir] = true;
        });
        
        btn.addEventListener("touchend", (e) => {
            e.preventDefault(); 
            moveKeys[dir] = false;
        });
        
        btn.addEventListener("mousedown", () => {
            moveKeys[dir] = true;
        });
        
        btn.addEventListener("mouseup", () => {
            moveKeys[dir] = false;
        });
        
        btn.addEventListener("mouseleave", () => {
            moveKeys[dir] = false;
        });
    });
});

// Initialize Phaser game
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 500,
    parent: 'game-container',
    backgroundColor: "#111",
    physics: { 
        default: "arcade", 
        arcade: { 
            gravity: {y: 0}, 
            debug: false 
        } 
    },
    scene: [MenuScene, GameScene]
};

const game = new Phaser.Game(config);
</script>
</body>
</html>
